(()=>{"use strict";var e=function(e,t,n,o){var r=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.disabled=!1}(r,o):function(e,t){e.classList.add(t),e.disabled=!0}(r,o)};function t(e){e.target.classList.contains("popup_opened")&&r(e.target.closest(".popup"))}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");r(t)}}var o=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n),document.addEventListener("mousedown",t)},r=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",t)},u=document.querySelector(".profile"),c=u.querySelector(".profile__name"),a=u.querySelector(".profile__description"),l=u.querySelector(".profile__avatar"),i=document.querySelector(".popup-edit-avatar"),s=document.querySelector(".popup_edit"),p=s.querySelector(".popup__input_name"),d=s.querySelector(".popup__input_description"),f=[],_={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"5502817d-dfaa-490b-a84a-6a16353d0f1d","Content-Type":"application/json"}};function m(e,t){var n=document.querySelector(".popup_add-photo");fetch(_.baseUrl+"/cards",{method:"POST",headers:_.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.json()})).then((function(e){return console.log(e._id),r(n),e})).catch((function(e){console.log(e),r(n)}))}function v(){return fetch(_.baseUrl+"/users/me",{headers:_.headers}).then((function(e){return e.json()})).then((function(e){c.textContent=e.name,a.textContent=e.about})),c.textContent}function y(e,t){for(var n=0;n<Object(e[t].likes).length;n++)if(Object(e[t].likes[n]).name===v())return!0}function h(e,t){if(Object(e[t].owner).name===v())return!0}var S,b,q,g=function(){return Promise.all([v(),fetch(_.baseUrl+"/cards",{headers:_.headers}).then((function(e){return e.json()})).then((function(e){for(var t=0;t<e.length;t++)f[t]={name:e[t].name,link:e[t].link,likes:e[t].likes.length,id:e[t]._id,myLikes:y(e,t),myCard:h(e,t)};return f})).catch((function(e){console.log(e)})),fetch(_.baseUrl+"/users/me",{headers:_.headers}).then((function(e){return e.json()})).then((function(e){l.style="background-image: url(".concat(e.avatar,")"),r(i)}))])},k=document.querySelector(".profile"),C=k.querySelector(".profile__name"),L=k.querySelector(".profile__description"),E=k.querySelector(".profile__button-edit"),x=k.querySelector(".profile__button-plus"),O=k.querySelector(".profile__avatar"),j=document.querySelector(".popup-edit-avatar"),U=j.querySelector(".popup-avatar"),w=document.querySelector(".popup_edit"),A=w.querySelector(".popup__input_name"),P=w.querySelector(".popup__input_description"),T=document.querySelector(".popup_add-photo"),D=T.querySelector(".popup__input_card-name"),N=T.querySelector(".popup__input_card-link"),B=document.querySelectorAll(".popup__button-close"),J=document.querySelector(".popup__add-button"),z=document.querySelector(".elements__list");function H(e){z.prepend(function(e){var t=document.querySelector(".card").content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__photo"),r=t.querySelector(".element__button-like"),u=t.querySelector(".element__button-delete"),c=e.id;return e.myCard||(u.disabled=!0),e.myLikes&&r.classList.add("element__button-like_active"),n.src=e.link,n.alt=e.name,r.textContent=e.likes,t.querySelector(".element__text").textContent=e.name,u.addEventListener("click",(function(e){!function(e){fetch(_.baseUrl+"/cards/"+e,{method:"DELETE",headers:_.headers})}(c),e.target.closest(".element").remove()})),r.addEventListener("click",(function(e){e.target.classList.toggle("element__button-like_active"),e.target.classList.contains("element__button-like_active")?(function(e){fetch(_.baseUrl+"/cards/likes/"+e,{method:"PUT",headers:_.headers})}(c),e.target.textContent=Number(e.target.textContent)+1):(function(e){fetch(_.baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:_.headers})}(c),e.target.textContent=Number(e.target.textContent)-1),console.log(c)})),n.addEventListener("click",(function(){return function(e){var t=document.querySelector(".popup_zoom"),n=t.querySelector(".popup-full-screen__photo"),r=t.querySelector(".popup-full-screen__description");n.src=e.link,n.alt=e.name,r.textContent=e.name,o(t)}(e)})),t}(e))}b=(S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"}).formSelector,q=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},u=Object.keys(e);for(o=0;o<u.length;o++)n=u[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(S,["formSelector"]),Array.from(document.querySelectorAll(b)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var o=n.inputSelector,r=n.inputErrorClass,u=(n.errorClass,n.submitButtonSelector),c=n.inactiveButtonClass,a=Array.from(t.querySelectorAll(o));a.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(t),n.textContent=""}(t,n,o):function(e,t,n,o){e.classList.add(t),n.textContent=o}(t,n,o,t.validationMessage)}(t,n,r),e(t,a,u,c)}))})),e(t,a,u,c)}(t,q)})),B.forEach((function(e){e.addEventListener("click",(function(e){return r(e.target.closest(".popup"))}))})),E.addEventListener("click",(function(){o(w),A.value=C.textContent,P.value=L.textContent})),w.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault(),w.querySelector(".popup__button").textContent="Сохранение...",C.textContent=A.value,L.textContent=P.value,fetch(_.baseUrl+"/users/me",{method:"PATCH",headers:_.headers,body:JSON.stringify({name:p.value,about:d.value})}).then((function(){console.log("Новое имя: "+v())})),g(),r(w)})),O.addEventListener("click",(function(){o(j),console.log("был клик")})),j.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),j.querySelector(".popup__button").textContent="Сохранение...",t=U.value,fetch(_.baseUrl+"/users/me/avatar",{method:"PATCH",headers:_.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.json()})).then((function(e){console.log(e)})),g(),U.value=""})),x.addEventListener("click",(function(){return o(T)})),T.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var t={name:D.value,link:N.value,myCard:!0,id:m(D.value,N.value)};T.querySelector(".popup__button").textContent="Сохранение...",H(t),g(),D.value="",N.value="",J.disabled=!0,J.textContent="Создать",J.classList.add("popup__button_disabled")})),g().then((function(){f.reverse().forEach((function(e){H(e)}))})).catch((function(e){return console.log(e)}))})();