(()=>{"use strict";var e=function(e,t,n,o){var r=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.disabled=!1}(r,o):function(e,t){e.classList.add(t),e.disabled=!0}(r,o)};function t(e){e.target.classList.contains("popup_opened")&&l(e.target.closest(".popup"))}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");l(t)}}var o,r,u,c=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n),document.addEventListener("mousedown",t)},l=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n),document.removeEventListener("mousedown",t)},a={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"5502817d-dfaa-490b-a84a-6a16353d0f1d","Content-Type":"application/json"}},i=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},s=document.querySelector(".profile"),p=s.querySelector(".profile__name"),d=s.querySelector(".profile__description"),f=s.querySelector(".profile__button-edit"),_=s.querySelector(".profile__button-plus"),m=s.querySelector(".profile__avatar"),h=document.querySelector(".popup-edit-avatar"),v=h.querySelector(".popup-avatar"),y=document.querySelector(".popup_edit"),b=y.querySelector(".popup__input_name"),g=y.querySelector(".popup__input_description"),S=document.querySelector(".popup_add-photo"),q=S.querySelector(".popup__input_card-name"),k=S.querySelector(".popup__input_card-link"),C=document.querySelectorAll(".popup__button-close"),L=document.querySelector(".popup__add-button"),E=document.querySelector(".elements__list");function x(e){E.prepend(function(e){var t=document.querySelector(".card").content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__photo"),o=t.querySelector(".element__button-like"),r=t.querySelector(".element__button-delete"),u=e.id;return e.myCard||(r.disabled=!0),e.myLikes&&o.classList.add("element__button-like_active"),n.src=e.link,n.alt=e.name,o.textContent=e.likes,t.querySelector(".element__text").textContent=e.name,r.addEventListener("click",(function(e){(function(e){return fetch(a.baseUrl+"/cards/"+e,{method:"DELETE",headers:a.headers}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))})(u).then((function(){e.target.closest(".element").remove()})).catch((function(e){return console.log(e)}))})),o.addEventListener("click",(function(e){e.target.classList.contains("element__button-like_active")?function(e){return console.log(e),fetch(a.baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:a.headers}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))}(u).then((function(t){console.log(t),e.target.textContent=Number(e.target.textContent)-1,e.target.classList.toggle("element__button-like_active")})).catch((function(e){return console.log(e)})):function(e){return fetch(a.baseUrl+"/cards/likes/"+e,{method:"PUT",headers:a.headers}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))}(u).then((function(t){console.log(t),e.target.classList.toggle("element__button-like_active"),e.target.textContent=Number(e.target.textContent)+1})).catch((function(e){return console.log(e)}))})),n.addEventListener("click",(function(){return function(e){var t=document.querySelector(".popup_zoom"),n=t.querySelector(".popup-full-screen__photo"),o=t.querySelector(".popup-full-screen__description");n.src=e.link,n.alt=e.name,o.textContent=e.name,c(t)}(e)})),t}(e))}function O(){return fetch(a.baseUrl+"/users/me",{headers:a.headers}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))}r=(o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"}).formSelector,u=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},u=Object.keys(e);for(o=0;o<u.length;o++)n=u[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)n=u[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(o,["formSelector"]),Array.from(document.querySelectorAll(r)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var o=n.inputSelector,r=n.inputErrorClass,u=(n.errorClass,n.submitButtonSelector),c=n.inactiveButtonClass,l=Array.from(t.querySelectorAll(o));l.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(t),n.textContent=""}(t,n,o):function(e,t,n,o){e.classList.add(t),n.textContent=o}(t,n,o,t.validationMessage)}(t,n,r),e(t,l,u,c)}))})),e(t,l,u,c)}(t,u)})),C.forEach((function(e){e.addEventListener("click",(function(e){return l(e.target.closest(".popup"))}))}));var j,U=[];function P(e,t){for(var n=0;n<Object(e[t].likes).length;n++)if(Object(e[t].likes[n])._id===j)return!0}function w(e,t){if(Object(e[t].owner)._id===j)return!0}Promise.all([O().then((function(e){return e.name})).catch((function(e){return console.log(e)})),O().then((function(e){return e.about})).catch((function(e){return console.log(e)})),O().then((function(e){return e._id})).catch((function(e){return console.log(e)})),O().then((function(e){return e.avatar})).catch((function(e){return console.log(e)}))]).then((function(e){return p.textContent=e[0],d.textContent=e[1],m.style="background-image: url(".concat(e[3],")"),e[2]})).catch((function(e){return console.log(e)})).then((function(e){j=e,console.log(j),fetch(a.baseUrl+"/cards",{headers:a.headers}).then((function(e){return i(e)})).then((function(e){for(var t=e.length-1;t>=0;t--)U[t]={name:e[t].name,link:e[t].link,likes:e[t].likes.length,id:e[t]._id,myLikes:P(e,t),myCard:w(e,t)},x(U[t])})).catch((function(e){console.log(e)}))})),_.addEventListener("click",(function(){return c(S)})),S.querySelector(".popup__form").addEventListener("submit",(function(e){var t,n;e.preventDefault(),S.querySelector(".popup__button").textContent="Сохранение...",(t=q.value,n=k.value,fetch(a.baseUrl+"/cards",{method:"POST",headers:a.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))).then((function(e){var t={};t.name=e.name,t.link=e.link,t.id=e._id,t.myCard=!0,x(t),l(S),q.value="",k.value="",L.textContent="Создать",L.disabled=!0,L.classList.add("popup__button_disabled")})).catch((function(e){return console.log(e)}))})),f.addEventListener("click",(function(){c(y),b.value=p.textContent,g.value=d.textContent})),y.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault(),y.querySelector(".popup__button").textContent="Сохранение...",fetch(a.baseUrl+"/users/me",{method:"PATCH",headers:a.headers,body:JSON.stringify({name:b.value,about:g.value})}).then((function(e){return i(e)})).catch((function(e){return console.log(e)})).then((function(e){console.log(e),p.textContent=e.name,d.textContent=e.about,y.querySelector(".popup__button").textContent="Сохранить",l(y)}))})),m.addEventListener("click",(function(){c(h)})),h.querySelector(".popup__form").addEventListener("submit",(function(e){var t;e.preventDefault(),h.querySelector(".popup__button").textContent="Сохранение...",(t=v.value,fetch(a.baseUrl+"/users/me/avatar",{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:t})}).then((function(e){return i(e)})).catch((function(e){return console.log(e)}))).then((function(e){m.style="background-image: url(".concat(e.avatar,")"),y.querySelector(".popup__button").textContent="Сохранить",l(h)})),v.value=""}))})();