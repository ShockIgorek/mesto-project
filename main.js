(()=>{"use strict";var e=function(e,t,n,r){var o=e.querySelector(n);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t),e.disabled=!1}(o,r):function(e,t){e.classList.add(t),e.disabled=!0}(o,r)},t=document.querySelector(".popup_zoom"),n=t.querySelector(".popup-full-screen__photo"),r=t.querySelector(".popup-full-screen__description");function o(e){e.target.classList.contains("popup_opened")&&s(e.target)}function u(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");s(t)}}var c,a,i,l=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u),document.addEventListener("mousedown",o)},s=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u),document.removeEventListener("mousedown",o)},d={baseUrl:"https://nomoreparties.co/v1/plus-cohort-6",headers:{authorization:"5502817d-dfaa-490b-a84a-6a16353d0f1d","Content-Type":"application/json"}},p=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},f=function(e,o,u,c,a,i){var s=document.querySelector(".card").content.querySelector(".element").cloneNode(!0),f=s.querySelector(".element__photo"),_=s.querySelector(".element__button-like"),m=s.querySelector(".element__button-delete"),v=s.querySelector(".element__text");return i||(m.disabled=!0),a&&_.classList.add("element__button-like_active"),f.src=o,f.alt=e,v.textContent=e,_.textContent=c,m.addEventListener("click",(function(e){(function(e){return fetch(d.baseUrl+"/cards/"+e,{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))})(u).then((function(){e.target.closest(".element").remove()})).catch((function(e){return console.log(e)}))})),_.addEventListener("click",(function(e){e.target.classList.contains("element__button-like_active")?function(e){return console.log(e),fetch(d.baseUrl+"/cards/likes/"+e,{method:"DELETE",headers:d.headers}).then((function(e){return p(e)}))}(u).then((function(t){e.target.textContent=t.likes.length,e.target.classList.toggle("element__button-like_active")})).catch((function(e){return console.log(e)})):function(e){return fetch(d.baseUrl+"/cards/likes/"+e,{method:"PUT",headers:d.headers}).then((function(e){return p(e)}))}(u).then((function(t){e.target.classList.toggle("element__button-like_active"),e.target.textContent=t.likes.length})).catch((function(e){return console.log(e)}))})),f.addEventListener("click",(function(){return function(e,o){n.src=o,n.alt=e,r.textContent=e,l(t)}(e,o)})),s},_=document.querySelector(".profile"),m=_.querySelector(".profile__name"),v=_.querySelector(".profile__description"),y=_.querySelector(".profile__button-edit"),h=_.querySelector(".profile__button-plus"),b=_.querySelector(".profile__avatar"),S=document.querySelector(".popup-edit-avatar"),g=S.querySelector(".popup-avatar"),q=document.querySelector(".popup_edit"),L=q.querySelector(".popup__input_name"),E=q.querySelector(".popup__input_description"),k=document.querySelector(".popup_add-photo"),C=k.querySelector(".popup__input_card-name"),x=k.querySelector(".popup__input_card-link"),O=document.querySelectorAll(".popup__button-close"),A=document.querySelector(".popup__add-button"),w=document.querySelector(".elements__list"),U=k.querySelector(".popup__form"),j=q.querySelector(".popup__form"),P=q.querySelector(".popup__button"),T=S.querySelector(".popup__form"),B=S.querySelector(".popup__button");function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}a=(c={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"}).formSelector,i=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(c,["formSelector"]),Array.from(document.querySelectorAll(a)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=n.inputSelector,o=n.inputErrorClass,u=(n.errorClass,n.submitButtonSelector),c=n.inactiveButtonClass,a=Array.from(t.querySelectorAll(r));a.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector("#error-".concat(t.id));t.validity.valid?function(e,t,n){e.classList.remove(t),n.textContent=""}(t,n,r):function(e,t,n,r){e.classList.add(t),n.textContent=r}(t,n,r,t.validationMessage)}(t,n,o),e(t,a,u,c)}))})),e(t,a,u,c)}(t,i)})),O.forEach((function(e){e.addEventListener("click",(function(e){return s(e.target.closest(".popup"))}))})),Promise.all([fetch(d.baseUrl+"/users/me",{headers:d.headers}).then((function(e){return p(e)})),fetch(d.baseUrl+"/cards",{headers:d.headers}).then((function(e){return p(e)}))]).then((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,u=[],c=!0,a=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(u.push(r.value),!t||u.length!==t);c=!0);}catch(e){a=!0,o=e}finally{try{c||null==n.return||n.return()}finally{if(a)throw o}}return u}}(e,t)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];m.textContent=n.name,v.textContent=n.about,b.style="background-image: url(".concat(n.avatar,")");for(var o=r.length-1;o>=0;o--){var u=Boolean(r[o].likes.find((function(e){return e._id===n._id}))),c=Boolean(r[o].owner._id===n._id);w.prepend(f(r[o].name,r[o].link,r[o]._id,r[o].likes.length,u,c))}return n._id})).catch((function(e){console.log(e)})),h.addEventListener("click",(function(){return l(k)})),U.addEventListener("submit",(function(e){var t,n;e.preventDefault(),A.textContent="Сохранение...",(t=C.value,n=x.value,fetch(d.baseUrl+"/cards",{method:"POST",headers:d.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return p(e)}))).then((function(e){w.prepend(f(e.name,e.link,e._id,void 0,void 0,!0)),s(k),C.value="",x.value="",A.disabled=!0,A.classList.add("popup__button_disabled")})).catch((function(e){return console.log(e)})).finally((function(){A.textContent="Создать"}))})),y.addEventListener("click",(function(){l(q),L.value=m.textContent,E.value=v.textContent})),j.addEventListener("submit",(function(e){var t,n;e.preventDefault(),P.textContent="Сохранение...",(t=L.value,n=E.value,fetch(d.baseUrl+"/users/me",{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return p(e)}))).then((function(e){m.textContent=e.name,v.textContent=e.about,P.disabled=!0,P.classList.add("popup__button_disabled"),s(q)})).catch((function(e){return console.log(e)})).finally((function(){P.textContent="Сохранить"}))})),b.addEventListener("click",(function(){l(S)})),T.addEventListener("submit",(function(e){var t;e.preventDefault(),B.textContent="Сохранение...",(t=g.value,fetch(d.baseUrl+"/users/me/avatar",{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:t})}).then((function(e){return p(e)}))).then((function(e){b.style="background-image: url(".concat(e.avatar,")"),g.value="",B.disabled=!0,B.classList.add("popup__button_disabled"),s(S)})).catch((function(e){return console.log(e)})).finally((function(){B.textContent="Сохранить"}))}))})();